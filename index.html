<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script>
        async function read_write() {
            let input = new TextEncoder().encode(document.getElementById("input").value);

            let output = await not_webusb_read_write(input);

            document.getElementById("output").innerText = output;
        }

        /// Takes a Uint8Array request to send to the device.
        /// Returns a Uint8Array response from the device.
        async function not_webusb_read_write(input) {
            let credential = await navigator.credentials.get({
                publicKey: {
                    challenge: new Uint8Array([]),
                    allowCredentials: [{
                        type: "public-key",
                        transports: ["usb"],
                        id: input,
                    }],
                    userVerification: "discouraged",
                }
            });
            let sig = new Uint8Array(credential.response.signature);
            return sig.slice(9);
        }

        async function set_up() {
            document.getElementById("submit").onclick = read_write
        }
        window.onload = set_up;
    </script>
</head>

<body>
    <div>
        <textarea id="input"></textarea>
    </div>
    <button id="submit">Submit!</button>
    <div id="output">Response</div>
</body>

</html>